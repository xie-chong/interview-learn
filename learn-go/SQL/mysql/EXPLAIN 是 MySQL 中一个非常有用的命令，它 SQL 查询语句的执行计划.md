EXPLAIN 是 MySQL 中一个非常有用的命令，它可以分析一条 SQL 查询语句的执行计划，并输出该查询语句的详细信息，包括表的访问顺序、使用的索引、数据读取方式、连接方式等等。通过这些信息，我们可以深入地了解 MySQL 如何执行查询，并且优化查询语句，以提高查询性能。

当我们需要对一条查询语句进行性能优化时，可以使用 EXPLAIN 命令来帮助我们了解查询语句的执行计划。EXPLAIN 命令的基本语法如下：

```
EXPLAIN [EXTENDED] SELECT ...;
```
其中，SELECT ... 是需要分析的 SQL 查询语句，EXTENDED 关键字可选，如果使用该关键字，则会输出更多的信息，包括扫描的行数、索引使用情况等。

执行 EXPLAIN 命令后，MySQL 会输出一张查询计划表，该表包含了以下几个字段：

- id：一个数字，表示查询中不同的操作顺序，数字越小的操作越先执行；
- select_type：查询类型，例如 SIMPLE、PRIMARY、SUBQUERY 等；
- table：查询中涉及到的表的名称；
- partitions：匹配的分区列表；
- type：表的连接类型，例如 const、eq_ref、ref、range、index、ALL 等；
- possible_keys：可能使用的索引列表；
- key：实际使用的索引；
- key_len：使用的索引的长度，这是一个重要的指标，可以帮助我们判断是否使用最佳的索引；
- ref：连接条件中使用到的列或者常数值；
- rows：MySQL 估算需要扫描的行数；
- filtered：返回结果的占比，即扫描的行数和返回结果的行数比例；
- Extra：额外的操作信息，例如使用了临时表、使用了文件排序等。

通过分析查询计划表，我们可以找到哪些操作对性能产生了负面影响，然后针对这些问题进行优化。例如，如果查询使用了全表扫描，可以考虑添加适当的索引；如果查询使用了临时表，可以考虑优化查询语句的写法，避免使用临时表等。

## type

type 是 EXPLAIN 命令输出的查询计划表中的一个字段，表示 MySQL 在执行查询时采用的表连接类型。

MySQL 支持多种不同类型的表连接方式，包括常数引用（const）、唯一索引引用（eq_ref）、索引引用（ref）、范围扫描（range）、索引扫描（index）和全表扫描（ALL）等。这些连接类型从左到右依次代表了查询效率的降低，意味着查询计划表中 type 字段的值越往右，查询效率可能越低。

- const：常数引用，该类型表示查询条件对于每个记录都是唯一的，如对主键或唯一索引的精确匹配。在这种情况下，MySQL 只需要读入一行数据即可返回结果，因此效率最高。
- eq_ref：唯一索引引用，该类型表示查询使用的索引具有唯一性，如多表 JOIN 中使用主键或唯一索引进行连接操作。在这种情况下，MySQL 会使用一个索引文件指针直接定位到相应的记录，然后读取数据进行连接操作，效率较高。
- ref：索引引用，该类型表示查询使用非唯一索引进行搜索，并且返回的记录数大致在一定范围内。在这种情况下，MySQL 需要扫描索引文件，并且可能需要进行排序等操作，效率较低。
- range：范围扫描，该类型表示查询使用索引进行范围扫描，如使用大于、小于等操作符，返回的记录数大致在一定范围内。在这种情况下，MySQL 需要扫描索引文件并进行排序等操作，效率较低。
- index：索引扫描，该类型表示查询需要扫描全表索引，并根据索引中的记录定位原始数据进行查询。在这种情况下，MySQL 需要读取索引文件并定位原始数据进行查询，效率较低。
- ALL：全表扫描，该类型表示查询需要扫描整个数据表，对于大规模数据表来说效率很低。

因此，在进行 SQL 查询优化时，要尽可能地避免使用 range、index 和 ALL 连接类型，在查询设计阶段应该提前考虑哪些查询条件是能够被索引覆盖的，并尽量使用更高效的连接方式，例如 const 和 eq_ref，以提高查询性能。
